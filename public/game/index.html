<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <base href="/game/" />
  <title>Stellar Siege — Roguelite Arena</title>
  <meta name="description" content="Stellar Siege is a browser-based roguelite space shooter with Survival, Campaign, and Online Duel modes." />
  <meta name="keywords" content="stellar siege, browser game, web shooter, roguelite shooter, online pvp game, space shooter" />
  <meta name="theme-color" content="#0b0f1f" />
  <meta property="og:title" content="Stellar Siege — Roguelite Arena" />
  <meta property="og:description" content="Survive waves, complete campaign missions, upgrade ships, and duel online." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/game/brand.svg" />
  <meta property="og:url" content="/game/index.html" />
  <link rel="canonical" href="/game/index.html" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="apple-touch-icon" href="favicon.svg" />

</head>
<body>
  <div class="layout">
  <div id="gameRoot" class="gameRoot">
  <div id="bootLoader" class="bootLoader">
    <div class="bootLoader__panel">
      <h1>Stellar Siege</h1>
      <p id="bootLoaderText">Preparing systems...</p>
      <div class="bootLoader__bar"><div id="bootLoaderFill" class="bootLoader__fill"></div></div>
      <button id="bootStartBtn" class="btn">Start Mission</button>
    </div>
  </div>
  <div class="ui" id="ui">
    <div class="topLeft">
      <button id="menuBtn" class="menuBtn" aria-label="Menu">☰</button>
      <div id="sideMenu" class="sideMenu hidden">
        <button id="menuResumeBtn" class="btnGhost">Resume</button>
        <button id="menuHomeBtn" class="btnGhost">Home</button>
        <button id="menuRestartBtn" class="btnGhost">Restart</button>
        <button id="menuCampaignBtn" class="btnGhost">Campaign</button>
        <button id="menuHangarBtn" class="btnGhost">Hangar</button>
        <button id="menuLeaderboardBtn" class="btnGhost">Leaderboard</button>
        <button id="menuOnlineBtn" class="btnGhost portal-hide">Online</button>
        <button id="sideFullscreenBtn" class="btnGhost">Fullscreen</button>
        <button id="sideInfoBtn" class="btnGhost">Game Info</button>
        <button id="menuResetBtn" class="btnGhost">Reset Progress</button>
        <div class="sideSection">
          <div class="sideSection__title">Aim Assist</div>
          <label class="sideToggle">
            <input id="tapAssistToggle" type="checkbox" />
            <span>Tap Assist</span>
          </label>
          <label class="sideToggle">
            <input id="stickyLockToggle" type="checkbox" />
            <span>Sticky Lock</span>
          </label>
          <label class="sideRange" for="aimAssistStrength">
            <span>Aim Strength</span>
            <div class="sideRange__row">
              <input id="aimAssistStrength" type="range" min="0" max="100" step="1" />
              <strong id="aimAssistStrengthValue">0%</strong>
            </div>
          </label>
        </div>
        <div class="fine" style="margin:10px 6px 0">Tip: Progress saves locally on this device.</div>
      </div>
    </div>

    <div class="topCenterBrand" aria-label="Stellar Siege">
      <img class="brandImg" src="brand.svg" alt="Stellar Siege" />
    </div>

    <div class="topRight">
      <div class="balances" aria-label="Balances">
        <div class="bal" title="Credits">
          <span class="bal__shape bal__shape--coin" aria-hidden="true"></span>
          <span class="bal__label">Credits</span>
          <span id="topCredits">0</span>
        </div>
        <div class="bal" title="Crystals">
          <span class="bal__shape bal__shape--crystal" aria-hidden="true"></span>
          <span class="bal__label">Crystals</span>
          <span id="topCrystals">0</span>
        </div>
      </div>
      <button id="topSignInBtn" class="btnAuth">Sign in</button>
      <button id="topAccountBtn" class="avatarBtn hidden" aria-label="Account">
        <img id="topAvatarImg" class="avatarImg hidden" alt="" />
        <span id="topAvatarFallback" class="avatarFallback">P</span>
      </button>
      <button id="topSignOutBtn" class="btnAuthGhost hidden">Sign out</button>
    </div>

    <div id="hud" class="hud hidden">
      <div class="hud__row">
        <div class="hud__item">Score <span id="score">0</span></div>
        <div class="hud__item">Wave <span id="wave">1</span></div>
        <div class="hud__item">Combo <span id="combo">x1</span></div>
        <div class="hud__item">Lvl <span id="level">1</span></div>
        <div class="hud__item hud__item--credits">Credits <span id="credits">0</span></div>
        <div class="hud__item hud__item--crystals">Crystals <span id="crystals">0</span></div>
        <div class="hud__item hud__item--wide">Objective <span id="objective">—</span></div>
      </div>
      <div class="bars">
        <div class="bar">
          <div class="bar__label">Shield</div>
          <div class="bar__track"><div id="shieldBar" class="bar__fill"></div></div>
        </div>
        <div class="bar">
          <div class="bar__label">Hull</div>
          <div class="bar__track"><div id="hullBar" class="bar__fill bar__fill--hull"></div></div>
        </div>
      </div>
    </div>

    <div class="touchControls" aria-label="Touch controls">
      <div class="joystick" id="joy">
        <div class="joystick__base" id="joyBase" aria-hidden="true">
          <div class="joystick__stick" id="joyStick"></div>
        </div>
      </div>
      <div class="touchControls__actions">
        <button class="touchBtn touchBtn--shoot" id="touchShoot" aria-label="Shoot">SH</button>
        <button class="touchBtn touchBtn--assist hidden" id="touchAutoLockBtn" aria-label="Auto Lock">AUTO LOCK</button>
      </div>
    </div>

    <div id="menu" class="overlay">
      <div class="panel panel--wide">
        <div class="titleRow">
          <h1>Stellar Siege</h1>
          <div class="pill">Roguelite Arena</div>
        </div>
        <img class="menuBrand" src="brand.svg" alt="Stellar Siege" />
        <p class="sub">WASD / Arrows to move · Mouse to aim · Click or Space to shoot</p>
        <div class="menuGrid">
          <button id="playSurvivalBtn">Play Survival</button>
          <button id="playCampaignBtn">Campaign</button>
          <button id="hangarBtn">Hangar & Upgrades</button>
          <button id="leaderboardBtn">Leaderboard</button>
          <button id="onlineBtn" class="portal-hide">Online Duel (Beta)</button>
          <button id="menuFullscreenBtn">Fullscreen</button>
          <button id="infoBtn">Game Info</button>
        </div>
        <div id="guestSyncBanner" class="guestSyncBanner hidden">
          <span>Sign in to sync progress + submit global leaderboard.</span>
          <div class="guestSyncBanner__actions">
            <button id="guestSyncSignInBtn" class="btnGhost">Sign in</button>
            <button id="guestSyncCloseBtn" class="btnGhost" aria-label="Dismiss sync banner">X</button>
          </div>
        </div>
        <div class="missionBoard" id="missionBoard"></div>
        <div class="fine">
          Tip: Collect upgrade orbs mid-run. Spend Credits/Crystals in the Hangar.
        </div>
        <div class="fine" style="margin-top:10px">
          <a href="/privacy.html" target="_blank" rel="noopener">Privacy</a> ·
          <a href="/terms.html" target="_blank" rel="noopener">Terms</a>
        </div>
      </div>
    </div>

    <div id="hangar" class="overlay hidden">
      <div class="panel panel--wide">
        <div class="panelTop">
          <h2>Hangar</h2>
          <div class="panelTop__right">
            <div class="pill" id="pilotPill">Pilot</div>
            <button class="btnGhost" id="backFromHangarBtn">Back</button>
          </div>
        </div>

        <div class="hangarGrid">
          <div class="card">
            <h3>Ship Stats</h3>
            <div class="shipModel" id="shipModel"></div>
            <div class="tierPicker" id="tierPicker">
              <button id="tierT1Btn" class="btnGhost">T1</button>
              <button id="tierT2Btn" class="btnGhost">T2</button>
              <button id="tierT3Btn" class="btnGhost">T3</button>
            </div>
            <div id="unlockFx" class="unlockFx hidden">Unlocked!</div>
            <div id="shipPicker" class="shipPicker"></div>
            <div id="statsBox" class="stats"></div>
          </div>
          <div class="card">
            <h3>Upgrades</h3>
            <div id="upgradeList" class="list"></div>
            <div id="hangarAdBox" class="adReward">
              <div class="adReward__title">Optional Rewarded Boost</div>
              <div class="adReward__text">Watch optional rewarded ads for a small progress boost.</div>
              <div class="row">
                <button id="hangarAdCreditsBtn" class="btn">Watch Ad → +350 Credits</button>
                <button id="hangarAdCrystalsBtn" class="btnGhost">Watch Ad → +2 Crystals</button>
              </div>
            </div>
          </div>
          <div class="card portal-hide" id="storeCard">
            <h3>Store</h3>
            <div class="store">
              <div class="storeRow">
                <div>
                  <div class="storeName">100 Crystals</div>
                  <div class="storeDesc">Crystals are account-based (requires sign-in)</div>
                </div>
                <button class="btn" id="buy100">$0.99</button>
              </div>
              <div class="storeRow">
                <div>
                  <div class="storeName">550 Crystals</div>
                  <div class="storeDesc">Best value pack</div>
                </div>
                <button class="btn" id="buy550">$4.99</button>
              </div>
              <div class="storeRow">
                <div>
                  <div class="storeName">10,000 Credits</div>
                  <div class="storeDesc">Starter credit pack</div>
                </div>
                <button class="btn" id="buyCredits10k">$0.99</button>
              </div>
              <div class="storeRow">
                <div>
                  <div class="storeName">65,000 Credits</div>
                  <div class="storeDesc">Best value credit pack</div>
                </div>
                <button class="btn" id="buyCredits65k">$4.99</button>
              </div>
              <div class="storeRow">
                <div>
                  <div class="storeName">Convert Crystals → Credits</div>
                  <div class="storeDesc">1 crystal = 200 credits</div>
                </div>
                <button class="btn" id="convertBtn">Convert</button>
              </div>
              <div class="fine">Store items are available when enabled for this build.</div>
            </div>
          </div>
        </div>
        <div class="hangarActions">
          <button class="btnGhost" id="hangarHomeBtn">Back To Home</button>
        </div>
      </div>
    </div>

    <div id="leaderboard" class="overlay hidden">
      <div class="panel panel--wide">
        <div class="panelTop">
          <h2>Leaderboard</h2>
          <div class="panelTop__right">
            <button class="btnGhost" id="backFromLeaderboardBtn">Back</button>
          </div>
        </div>
        <div class="tabs">
          <button class="tab tab--active" id="tabLocal">Local</button>
          <button class="tab" id="tabGlobal">Global (needs login)</button>
        </div>
        <div id="leaderboardList" class="leaderboard"></div>
        <div class="fine">Global ranking uses: Wins desc, Losses asc, XP desc, then Online Games/Best Score.</div>
      </div>
    </div>

    <div id="campaign" class="overlay hidden">
      <div class="panel panel--wide">
        <div class="panelTop">
          <h2>Campaign</h2>
          <div class="panelTop__right">
            <button class="btnGhost" id="backFromCampaignBtn">Back</button>
          </div>
        </div>
        <div class="fine">Complete missions to unlock the next. Rewards scale with difficulty.</div>
        <div id="missionList" class="missionList"></div>
      </div>
    </div>

    <div id="online" class="overlay hidden">
      <div class="panel panel--wide">
        <div class="panelTop">
          <h2>Online Duel (Beta)</h2>
          <div class="panelTop__right">
            <button class="btnGhost" id="backFromOnlineBtn">Back</button>
          </div>
        </div>

        <div class="onlineGrid">
          <div class="card">
            <h3>Account</h3>
            <div id="authStatus" class="fine">Not connected.</div>
            <div class="row">
              <button class="btn" id="googleSignInBtn">Sign in with Google</button>
              <button class="btnGhost" id="signOutBtn">Sign out</button>
            </div>
            <div class="fine">Sign in to sync progress, enter online rooms, and submit global scores.</div>
          </div>
          <div class="card">
            <h3>Matchmaking</h3>
            <div class="row">
              <input id="roomCode" class="input" placeholder="Room code" autocapitalize="characters" autocomplete="off" spellcheck="false" />
              <button class="btn" id="createRoomBtn">Create</button>
              <button class="btn" id="joinRoomBtn">Join</button>
            </div>
            <div class="row" style="margin-top:10px; justify-content:flex-start">
              <button class="btn" id="startDuelBtn">Start Duel</button>
            </div>
            <div id="onlineHint" class="fine">Sign in to play online duel.</div>
          </div>
        </div>
      </div>
    </div>

    <div id="account" class="overlay hidden">
      <div class="panel panel--wide">
        <div class="panelTop">
          <h2>Account</h2>
          <div class="panelTop__right">
            <button class="btnGhost" id="closeAccountBtn">Close</button>
          </div>
        </div>
        <div id="accountBox" class="accountBox"></div>
        <div class="row" style="margin-top:14px">
          <button class="btn" id="accountSyncBtn">Sync Now</button>
          <button class="btnGhost" id="accountToOnlineBtn">Online</button>
          <button class="btnGhost" id="accountSignOutBtn">Sign out</button>
        </div>
        <div class="fine">Tip: Your local guest progress is always saved on this device.</div>
      </div>
    </div>

    <div id="upgradePick" class="overlay hidden">
      <div class="panel panel--wide">
        <h2>Choose Upgrade</h2>
        <div id="pickList" class="pickGrid"></div>
        <div class="fine">These upgrades last for this run only.</div>
      </div>
    </div>

    <div id="rotateOverlay" class="overlay hidden">
      <div class="panel">
        <div class="rotateIcon" aria-hidden="true"></div>
        <h2>Rotate Your Device</h2>
        <p>Please rotate your device to play</p>
      </div>
    </div>

    <div id="landscapeHint" class="landscapeHint hidden">Best in landscape. Portrait is still playable.</div>

    <div id="gameover" class="overlay hidden">
      <div class="panel">
        <h1 id="gameoverTitle">Signal Lost</h1>
        <div id="newRecordBadge" class="newRecordBadge hidden">NEW RECORD!</div>
        <p id="gameoverSub" class="fine" style="margin:10px 0 18px"></p>
        <p>Score: <span id="finalScore">0</span></p>
        <p>Wave: <span id="finalWave">1</span></p>
        <p>Kills: <span id="finalKills">0</span></p>
        <p>Best Kills: <span id="finalBestKills">0</span></p>
        <p>Rewards: <span id="finalRewards">0</span></p>
        <div id="adRewardBox" class="adReward">
          <div class="adReward__title">Bonus Reward</div>
          <div id="adRewardText" class="adReward__text">Watch an optional ad to continue with a bonus reward.</div>
          <button id="adRewardBtn" class="btn">Watch Ad → Continue Bonus</button>
        </div>
        <div class="row">
          <button id="restartBtn" class="btn">TRY AGAIN</button>
          <button id="shareScoreBtn" class="btnGhost">SHARE SCORE</button>
          <button id="copyLinkBtn" class="btnGhost">COPY LINK</button>
          <button id="challengeFriendBtn" class="btnGhost">CHALLENGE FRIEND</button>
          <button id="toMenuBtn" class="btnGhost">Menu</button>
        </div>
      </div>
    </div>

    <div id="infoOverlay" class="overlay hidden">
      <div class="panel panel--wide infoPanel">
        <div class="panelTop">
          <h2>Stellar Siege — Game Guide</h2>
          <div class="panelTop__right">
            <button id="infoFullscreenBtn" class="btnGhost">Fullscreen</button>
            <button id="infoCloseBtn" class="btnGhost">Close</button>
          </div>
        </div>
        <div class="infoSection">
          <h3>What is Stellar Siege?</h3>
          <p>Stellar Siege is a fast roguelite arena shooter. Survive waves, complete missions, and build your ship through upgrades and smarter tactics.</p>
        </div>
        <div class="infoSection">
          <h3>Game Modes</h3>
          <ul>
            <li><strong>Survival</strong> — Endless waves. Earn credits quickly.</li>
            <li><strong>Campaign</strong> — Mission objectives and unlocks.</li>
            <li><strong>Online Duel</strong> — Competitive matches and best rewards.</li>
          </ul>
        </div>
        <div class="infoSection">
          <h3>Online Duel Win Rule</h3>
          <ul>
            <li>Each player controls their own ship in real time.</li>
            <li>You win when the opponent ship HP reaches 0 first.</li>
            <li>Look for <strong>YOU</strong> and <strong>OPP</strong> labels above ships to avoid confusion.</li>
          </ul>
        </div>
        <div class="infoSection">
          <h3>Ships & Roles</h3>
          <ul>
            <li><strong>Scout / Striker</strong> — Fast all-round starters.</li>
            <li><strong>Tank / Sniper / Bomber</strong> — Heavy defense, precision, or burst damage playstyles.</li>
            <li><strong>Interceptor / Drone Carrier / Stealth</strong> — Mobility, utility, and advanced control builds.</li>
            <li><strong>Warden / Valkyrie / Nova Revenant</strong> — Late-game elite ships with high mastery ceilings.</li>
          </ul>
          <div class="infoShips"></div>
        </div>
        <div class="infoSection">
          <h3>Economy</h3>
          <ul>
            <li><strong>Credits</strong> — Earned by playing. Used for most upgrades and ships.</li>
            <li><strong>Crystals</strong> — Rare. Used for premium ships and upgrades.</li>
            <li><strong>XP</strong> — Increases your pilot level, boosting stats.</li>
          </ul>
        </div>
        <div class="infoSection">
          <h3>Upgrades</h3>
          <p>Upgrades are permanent per ship and require Google sign‑in to sync. Each upgrade increases your stats and changes your build style.</p>
        </div>
        <div class="infoSection">
          <h3>Purchases</h3>
          <p>Crystal packs are delivered after checkout and synced to your account. Purchases and upgrades are tied to your Google account for safety.</p>
        </div>
        <div class="infoSection">
          <h3>Tips</h3>
          <ul>
            <li>Use fullscreen for the best visibility.</li>
            <li>Strafe and kite to survive heavy waves.</li>
            <li>Campaign missions teach different tactics.</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="fsHint" class="fsHint hidden">Tip: Fullscreen is more comfortable. Press F on desktop or use the Fullscreen button on mobile.</div>
    <div id="toast" class="toast hidden"></div>

    <div id="dailyReward" class="overlay hidden">
      <div class="panel">
        <h2>Daily Reward</h2>
        <p id="dailyRewardSummary" class="fine"></p>
        <div id="dailyRewardLadder" class="dailyLadder"></div>
        <div class="row">
          <button id="dailyClaimBtn" class="btn">Claim Reward</button>
          <button id="dailyDoubleBtn" class="btnGhost hidden">Double Reward (Watch Ad)</button>
          <button id="dailyCloseBtn" class="btnGhost">Later</button>
        </div>
      </div>
    </div>
  </div>

  <canvas id="game" width="960" height="600"></canvas>
</div>

    <!-- Optional: Firebase config lives here (keep secrets out; web config is public). -->
    <script defer src="firebase-config.js"></script>
    <!-- Optional: Firebase SDKs (only used if FIREBASE_CONFIG is set). -->
    <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
    <script defer src="aim-targeting.js"></script>
    <script defer src="ship-3d.js"></script>
    <script defer src="rewarded-adapter.js"></script>
    <script defer src="script.js"></script>
  </div>
</body>
</html>
